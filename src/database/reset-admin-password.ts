import dotenv from 'dotenv';
import { AppDataSource } from '../config/database';
import { User } from '../entities/User';
import { hashPassword } from '../utils/password';

// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ· .env Ñ„Ğ°Ğ¹Ğ»Ğ°
dotenv.config();

const resetAdminPassword = async (): Promise<void> => {
  try {
    await AppDataSource.initialize();
    console.log('âœ… Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ°');

    const userRepository = AppDataSource.getRepository(User);

    // ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ ÑÑƒĞ¿ĞµÑ€Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°
    const admin = await userRepository.findOne({
      where: { email: 'admin@marina-crm.com' },
    });

    if (!admin) {
      console.error('âŒ Ğ¡ÑƒĞ¿ĞµÑ€Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½');
      console.log('ğŸ’¡ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ ÑÑƒĞ¿ĞµÑ€Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° Ñ‡ĞµÑ€ĞµĞ· npm run seed');
      process.exit(1);
    }

    // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
    const newPassword = 'admin123';
    const hashedPassword = await hashPassword(newPassword);

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
    admin.password = hashedPassword;
    await userRepository.save(admin);

    console.log('\nâœ… ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑÑƒĞ¿ĞµÑ€Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½!');
    console.log('\nğŸ“ ĞĞ¾Ğ²Ñ‹Ğµ ÑƒÑ‡ĞµÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ:');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log(`Email:    admin@marina-crm.com`);
    console.log(`ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ:   ${newPassword}`);
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log('\nâš ï¸  Ğ’ĞĞ–ĞĞ: Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ!');

    await AppDataSource.destroy();
  } catch (error) {
    console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ±Ñ€Ğ¾ÑĞµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ:', error);
    process.exit(1);
  }
};

resetAdminPassword();

