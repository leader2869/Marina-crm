# üí∞ –ú–æ–¥—É–ª—å "–ö–∞—Å—Å–∞" –¥–ª—è —Å—É–¥–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞ - –°—Ö–µ–º–∞

## üìã –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

–ú–æ–¥—É–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—É–¥–æ–≤–ª–∞–¥–µ–ª—å—Ü—É —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–∞—Å—Å–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–∞—Å—Å–∞ –∫–∞–ø–∏—Ç–∞–Ω–∞", "–ö–∞—Å—Å–∞ —Å—É–¥–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞"). –í –∫–∞–∂–¥–æ–π –∫–∞—Å—Å–µ –º–æ–∂–Ω–æ –≤–µ—Å—Ç–∏ —É—á–µ—Ç –ø—Ä–∏—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∏ –±–µ–∑–Ω–∞–ª–∏—á–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏.

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –¢–∞–±–ª–∏—Ü–∞: `vessel_owner_cashes` (–ö–∞—Å—Å—ã —Å—É–¥–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞)

```sql
CREATE TABLE vessel_owner_cashes (
  id SERIAL PRIMARY KEY,
  vessel_owner_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  name VARCHAR(255) NOT NULL, -- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Å—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–∞—Å—Å–∞ –∫–∞–ø–∏—Ç–∞–Ω–∞")
  description TEXT, -- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Å—Å—ã
  is_active BOOLEAN DEFAULT TRUE, -- –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∫–∞—Å—Å–∞
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  -- –ò–Ω–¥–µ–∫—Å—ã
  INDEX idx_vessel_owner_id (vessel_owner_id)
);
```

### 2. –¢–∞–±–ª–∏—Ü–∞: `cash_transactions` (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–∞—Å—Å—ã)

```sql
CREATE TABLE cash_transactions (
  id SERIAL PRIMARY KEY,
  cash_id INTEGER NOT NULL REFERENCES vessel_owner_cashes(id) ON DELETE CASCADE,
  transaction_type VARCHAR(20) NOT NULL, -- 'income' (–ø—Ä–∏—Ö–æ–¥) –∏–ª–∏ 'expense' (—Ä–∞—Å—Ö–æ–¥)
  amount DECIMAL(12, 2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'RUB',
  payment_method VARCHAR(20) NOT NULL, -- 'cash' (–Ω–∞–ª–∏—á–Ω—ã–µ) –∏–ª–∏ 'non_cash' (–±–µ–∑–Ω–∞–ª–∏—á–Ω—ã–µ)
  date DATE NOT NULL,
  description TEXT,
  counterparty VARCHAR(255), -- –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç
  document_path TEXT, -- –ü—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  -- –ò–Ω–¥–µ–∫—Å—ã
  INDEX idx_cash_id (cash_id),
  INDEX idx_transaction_type (transaction_type),
  INDEX idx_date (date)
);
```

---

## üìä –¢–∏–ø—ã –∏ Enums

### CashTransactionType

```typescript
export enum CashTransactionType {
  INCOME = 'income',   // –ü—Ä–∏—Ö–æ–¥
  EXPENSE = 'expense', // –†–∞—Å—Ö–æ–¥
}
```

### CashPaymentMethod

```typescript
export enum CashPaymentMethod {
  CASH = 'cash',       // –ù–∞–ª–∏—á–Ω—ã–µ
  NON_CASH = 'non_cash', // –ë–µ–∑–Ω–∞–ª–∏—á–Ω—ã–µ
}
```

---

## üéØ API Endpoints

### –ö–∞—Å—Å—ã (Cashes)

#### 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Å—Å
```
GET /api/vessel-owner/cashes
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "–ö–∞—Å—Å–∞ –∫–∞–ø–∏—Ç–∞–Ω–∞",
      "description": "–ö–∞—Å—Å–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –∫–∞–ø–∏—Ç–∞–Ω–∞",
      "isActive": true,
      "vesselOwnerId": 5,
      "createdAt": "2025-11-15T10:00:00Z",
      "updatedAt": "2025-11-15T10:00:00Z"
    }
  ],
  "total": 1,
  "page": 1,
  "limit": 20,
  "totalPages": 1
}
```

#### 2. –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Å—Å—É –ø–æ ID
```
GET /api/vessel-owner/cashes/:id
```

#### 3. –°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Å—É
```
POST /api/vessel-owner/cashes
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "name": "–ö–∞—Å—Å–∞ –∫–∞–ø–∏—Ç–∞–Ω–∞",
  "description": "–ö–∞—Å—Å–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –∫–∞–ø–∏—Ç–∞–Ω–∞"
}
```

#### 4. –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Å—Å—É
```
PUT /api/vessel-owner/cashes/:id
```

#### 5. –£–¥–∞–ª–∏—Ç—å –∫–∞—Å—Å—É
```
DELETE /api/vessel-owner/cashes/:id
```

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Cash Transactions)

#### 1. –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–∞—Å—Å—ã
```
GET /api/vessel-owner/cashes/:cashId/transactions
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- `startDate` - –Ω–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞
- `endDate` - –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞
- `transactionType` - —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (income/expense)
- `paymentMethod` - —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (cash/non_cash)

#### 2. –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø–æ ID
```
GET /api/vessel-owner/cashes/:cashId/transactions/:id
```

#### 3. –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
```
POST /api/vessel-owner/cashes/:cashId/transactions
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "transactionType": "income",
  "amount": 50000,
  "currency": "RUB",
  "paymentMethod": "cash",
  "date": "2025-11-15",
  "description": "–û–ø–ª–∞—Ç–∞ –∑–∞ –∞—Ä–µ–Ω–¥—É",
  "counterparty": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
}
```

#### 4. –û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
```
PUT /api/vessel-owner/cashes/:cashId/transactions/:id
```

#### 5. –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
```
DELETE /api/vessel-owner/cashes/:cashId/transactions/:id
```

#### 6. –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–∞—Å—Å—ã
```
GET /api/vessel-owner/cashes/:cashId/balance
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "cashId": 1,
  "cashName": "–ö–∞—Å—Å–∞ –∫–∞–ø–∏—Ç–∞–Ω–∞",
  "totalIncome": 150000.00,
  "totalExpense": 75000.00,
  "balance": 75000.00,
  "balanceByPaymentMethod": {
    "cash": 50000.00,
    "non_cash": 25000.00
  }
}
```

---

## üé® Frontend (React)

### –°—Ç—Ä–∞–Ω–∏—Ü–∞: `client/src/pages/Cash.tsx`

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

1. **–°–ø–∏—Å–æ–∫ –∫–∞—Å—Å:**
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞—Å—Å —Å—É–¥–æ–≤–ª–∞–¥–µ–ª—å—Ü–∞
   - –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Å—É"
   - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Å—Å

2. **–î–µ—Ç–∞–ª–∏ –∫–∞—Å—Å—ã:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Å—Å—ã
   - –ë–∞–ª–∞–Ω—Å –∫–∞—Å—Å—ã (–æ–±—â–∏–π, –Ω–∞–ª–∏—á–Ω—ã–µ, –±–µ–∑–Ω–∞–ª–∏—á–Ω—ã–µ)
   - –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:
     - –ü–æ —Ç–∏–ø—É (–ø—Ä–∏—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥)
     - –ü–æ —Å–ø–æ—Å–æ–±—É –æ–ø–ª–∞—Ç—ã (–Ω–∞–ª–∏—á–Ω—ã–µ/–±–µ–∑–Ω–∞–ª–∏—á–Ω—ã–µ)
     - –ü–æ –¥–∞—Ç–µ
   - –ö–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—Ö–æ–¥" –∏ "–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥"

3. **–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Å—Å—ã:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

4. **–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø—Ä–∏—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥)
   - –°—É–º–º–∞
   - –í–∞–ª—é—Ç–∞
   - –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–Ω–∞–ª–∏—á–Ω—ã–µ/–±–µ–∑–Ω–∞–ª–∏—á–Ω—ã–µ)
   - –î–∞—Ç–∞
   - –û–ø–∏—Å–∞–Ω–∏–µ
   - –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç
   - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
   - –û–±—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ –≤—Å–µ–º –∫–∞—Å—Å–∞–º
   - –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Å—Å–∞–º
   - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ø–æ—Å–æ–±–∞–º –æ–ø–ª–∞—Ç—ã

---

## üîê –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

- **VESSEL_OWNER** –º–æ–∂–µ—Ç:
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–∞—Å—Å—ã
  - –°–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–∞—Å—Å—ã
  - –°–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ–∏—Ö –∫–∞—Å—Å–∞—Ö

- **SUPER_ADMIN** –∏ **ADMIN** –º–æ–≥—É—Ç:
  - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –∫–∞—Å—Å—ã
  - –°–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –∫–∞—Å—Å—ã

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Backend:
- [ ] –°–æ–∑–¥–∞—Ç—å enum `CashTransactionType` –∏ `CashPaymentMethod` –≤ `src/types/index.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç—å `VesselOwnerCash` –≤ `src/entities/VesselOwnerCash.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç—å `CashTransaction` –≤ `src/entities/CashTransaction.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç—å `User` (–¥–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å `vesselOwnerCashes`)
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `VesselOwnerCashesController`
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `CashTransactionsController`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç—ã `vessel-owner-cashes.routes.ts` –∏ `cash-transactions.routes.ts`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç—ã –≤ `src/server.ts`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### Frontend:
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã –≤ `client/src/types/index.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `client/src/pages/Cash.tsx`
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ –∫–∞—Å—Å
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–µ—Ç–∞–ª–µ–π –∫–∞—Å—Å—ã
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Å—Å—ã
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –≥—Ä–∞—Ñ–∏–∫–∏

